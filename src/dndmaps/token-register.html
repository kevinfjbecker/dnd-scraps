<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>Tokens</title>
    <style>
        /* div {
            border: 1px solid steelblue;
        } */

        #register {
            border: 1px solid steelblue;
            padding: 0 5px 5px;
        }

        .register-entry {
            display: flex;
            border: 1px solid steelblue;
            margin: 5px 0 0;
        }

        .focused {
            border-width: 2px;
        }

        .selected {
            background-color: lightblue;
        }

        .image-container {
            display: flex;
            align-items: center;
            margin: 0 35px;
        }

        .detail {
            padding: 10px 0 20px;
        }

        .detail-entry {
            margin-bottom: 5px;
        }

        .detail-entry>label {
            display: block;
        }

        .token {
            background-size: contain;
            border-radius: 50%;
            border: 2px solid steelblue;
            width: 64px;
            height: 64px;
        }
    </style>
</head>

<body>
    <div id="register"></div>

    <script src="https://d3js.org/d3.v5.js"></script>
    <script>
        const gTokenSet = [
            {
                'name': 'ascydiaadderbanklin',
                'src': 'https://www.dndbeyond.com/Content/Skins/Waterdeep/images/characters/default-avatar-builder.png',
                'id': '54b5e05d-0e83-4085-ba48-eff951e925f5',
            },
            {
                'name': 'belvias',
                'src': 'https://www.dndbeyond.com/avatars/15619/537/1581111423-27483125.jpeg',
                'id': '2dc37dd3-ac78-4320-8dbb-236904074a4f',
            },
            {
                'name': 'biggschunks',
                'src': 'https://www.dndbeyond.com/avatars/17/193/636377838017798855.jpeg',
                'id': 'd1988fd3-3b5c-4c12-b113-298c5d0afc6b',
            },
            {
                'name': 'erkytimbers',
                'src': 'https://media-waterdeep.cursecdn.com/avatars/thumbnails/6557/537/35/35/636987985254139481.png',
                'id': '1b1c8655-9cbe-4cb3-95b5-506ab785f126',
            },
            {
                'name': 'florry',
                'src': 'https://www.dndbeyond.com/avatars/15619/576/1581111423-36028354.jpeg',
                'id': 'ee0e79ce-6b98-492d-bc03-ade3ee934375',
            },
            {
                'name': 'moreale',
                'src': 'https://www.dndbeyond.com/avatars/17/969/636378926856690034.png',
                'id': '5b93c2c8-7a1b-41fd-80fc-63d6baa06522',
            },
            {
                'name': 'professorblue',
                'src': 'https://www.dndbeyond.com/avatars/17/924/636378852753221520.jpeg',
                'id': 'fa08cef0-ad64-4044-8ecc-2b9d2c164e92',
            },
            {
                'name': 'slammer',
                'src': 'https://www.dndbeyond.com/avatars/17/468/636377891490355427.jpeg',
                'id': 'e718ed48-da1b-41fc-9286-0c3b89b92d1e',
            },
            {
                'name': 'belak',
                'src': 'https://www.dndbeyond.com/avatars/12746/393/637357523509675063.jpeg',
                'id': '8b154df6-d184-4e76-b493-32e3368d6386',
            },
            {
                'name': 'giantfrog',
                'src': 'https://media-waterdeep.cursecdn.com/avatars/thumbnails/16/520/35/35/636376321051878548.jpeg',
                'id': 'c5cd776e-4b15-46a3-becb-1f05912e85b1',
            },
            {
                'name': 'sirbraford',
                'src': 'https://www.dndbeyond.com/avatars/17/429/636377887024636048.jpeg',
                'id': 'a6b47dfd-9485-4d72-b10f-571f246079ef',
            },
            {
                'name': 'sharwynhucrele',
                'src': 'https://www.dndbeyond.com/avatars/10845/662/637266685562647414.jpeg',
                'id': 'dbe4bd72-5c7b-4741-bd90-4f87bd31661b',
            },
            {
                'name': 'twigblight',
                'src': 'https://media-waterdeep.cursecdn.com/avatars/thumbnails/16/463/35/35/636376286997146437.jpeg',
                'id': '90b8ffcd-a75a-4430-a189-657d40447440',
            },
            {
                'name': 'skeleton',
                'src': 'https://media-waterdeep.cursecdn.com/avatars/thumbnails/16/471/35/35/636376294572614519.jpeg',
                'id': 'c7f2bdd2-8ac0-4eba-a670-0ab1332888a7',
            },
            {
                'name': 'giantrat',
                'src': 'https://media-waterdeep.cursecdn.com/avatars/thumbnails/16/537/35/35/636376332197484465.jpeg',
                'id': 'aabc9327-0832-4c6b-8488-a4e28d55cf34',
            },
            {
                'name': 'bugbear',
                'src': 'https://media-waterdeep.cursecdn.com/avatars/thumbnails/0/220/35/35/636252765234155211.jpeg',
                'id': 'b1c5e3aa-7e10-41fe-84a4-121ac7fbd308',
            },
            {
                'name': 'firesnake',
                'src': 'https://media-waterdeep.cursecdn.com/avatars/thumbnails/9/101/35/35/636323502432374793.jpeg',
                'id': '70c257c4-20bb-4c58-b541-096e70c53c69',
            },
            {
                'name': 'goblin',
                'src': 'https://media-waterdeep.cursecdn.com/avatars/thumbnails/0/350/35/35/636252777818027282.jpeg',
                'id': 'd948bce9-072d-40f3-9c70-a2f7e40ad238',
            },
            {
                'name': 'shadow',
                'src': 'https://media-waterdeep.cursecdn.com/avatars/thumbnails/0/154/35/35/636252758976719287.jpeg',
                'id': '57d29929-b862-4786-8283-4719de2b88e2',
            },
        ];

        function updateRegister(tokenList) {
            const entries = d3.select('#register')
                .selectAll('.register-entry')
                .data(tokenList)

            entriesEnter = entries.enter().append('div')
                .classed('register-entry', true)
                .on('mouseover', function() {
                    d3.select(this).classed('focused', true);
                })
                .on('mouseout', function() {
                    d3.select(this).classed('focused', false);
                })
                .on('click', function() {
                    d3.selectAll('.register-entry').classed('selected', false);
                    d3.select(this).classed('selected', true);
                });

            entriesEnter.append('div')
                .classed('image-container', true)
                .append('div')
                .classed('token', true)
                .style('background-image', d => `url(${d.src})`);

            const details = entriesEnter.append('div')
                .classed('detail', true)
                .selectAll('.detail-entry')
                .data(d => Object.entries(d));

            const detailsEnter = details.enter().append('div')
                .classed('detail-entry', true);

            // todo: this is identical to map-register
            detailsEnter.append('label')
                .attr('for', d => `detail-${d[0]}`)
                .text(d => d[0]);

            detailsEnter.append('input')
                .attr('type', 'text')
                .attr('id', d => `detail-${d[0]}`)
                .attr('name', d => `detail-${d[0]}`)
                .attr('size', d => d[1].length)
                .each(function (d) { this.value = d[1]; });

            details.select('input')
                .attr('size', d => d[1].length)
                .each(function (d) { this.value = d[1]; });

        }

        (function init() {
            if (gTokenSet.length < 1) {
                return;
            }
            updateRegister(gTokenSet);
        })();

    </script>
    <script>
        getUuid = function b(
            a, // placeholder
        ) {
            return a ? // if the placeholder was passed, return
                ( // a random number from 0 to 15
                    a ^ // unless b is 8,
                    Math.random() * // in which case
                    16 >> // a random number from
                    a / 4 // 8 to 11
                ).toString(16) : // in hexadecimal
                ( // or otherwise a concatenated string:
                    [1e7] + // 10000000 +
                    -1e3 + // -1000 +
                    -4e3 + // -4000 +
                    -8e3 + // -80000000 +
                    -1e11 // -100000000000,
                ).replace( // replacing
                    /[018]/g, // zeroes, ones, and eights with
                    b, // random hex digits
                );
        };
    </script>

</body>

</html>